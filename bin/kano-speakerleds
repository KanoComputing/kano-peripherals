#!/usr/bin/env python

# kano-speakerleds
#
# Copyright (C) 2015 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU GPL v2
#
# Command for interacting with speaker LEDs
#
# UNSTABLE for 2.1.1


"""
Usage:
    kano-speakerleds detect
    kano-speakerleds notification (start|stop) [<spec>...]
    kano-speakerleds initflow [<duration>] [<cycles>]
    kano-speakerleds off
    kano-speakerleds manu_test <len1> <len2> <len3>
    kano-speakerleds -h | --help

Options:
    detect              Return 0 if the speaker LEDS are attached.
    notification        Start or stop a notification display.
    initflow            Display the initflow pattern.
    off                 Clear LEDs.
    -h, --help          Show this message.
"""


from docopt import docopt

from kano_peripherals import speaker_leds


def main(args):
    if args['detect']:
        rc = speaker_leds.detect()
        exit(rc)

    elif args['notification']:
        if args['start']:
            speaker_leds.notification_start(args['<spec>'])
        elif args['stop']:
            speaker_leds.notification_stop()

    elif args['initflow']:
        try:
            duration = float(args.get('<duration>')) if args.get('<duration>') else 2.0
            cycles = float(args.get('<cycles>')) if args.get('<cycles>') else 4.0
        except:
            print "Duration and Cycles must be numbers"
        speaker_leds.initflow_pattern_start(duration, cycles)

    elif args['off']:
        speaker_leds.leds_off()

    elif args['manu_test']:
        try:
            l1 = float(args['<len1>'])
            l2 = float(args['<len2>'])
            l3 = float(args['<len3>'])
        except:
            print "incorrect arguments to manu_test"
            exit(1)

        speaker_leds.manufacturing_test_start(l1, l2, l3)


if __name__ == "__main__":
    args = docopt(__doc__)
    main(args)
